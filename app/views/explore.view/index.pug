extends ../layout

block content
  html
    head
      title= "Món Ăn"
      link(rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css")
      script(src="https://unpkg.com/leaflet/dist/leaflet.js")
      script(src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js")
      script(src="https://unpkg.com/geolib/dist/geolib.js")

      style.
        #map {
          background-size: cover;
          background-position: center;
        }

        .card {
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          transition: all 0.3s ease-in-out;
        }

        .card:hover {
          transform: scale(1.02);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
          background-color: #ff6600;
          border-color: #ff6600;
        }

        .btn-primary:hover {
          background-color: #e65500;
          border-color: #e65500;
        }

        .masthead-subheading {
          text-transform: uppercase;
        }

        .pagination {
          display: flex;
          justify-content: center;
          margin-top: 20px;
        }

        .pagination a {
          padding: 8px 12px;
          margin: 0 2px;
          background-color: #f0f0f0;
          border-radius: 4px;
          text-decoration: none;
          font-size: 14px;
        }

        .pagination a:hover {
          background-color: #e0e0e0;
        }

        .pagination .active .page-link {
          background-color: #ff6600;
          border-color: #ff6600;
          color: white;
        }

        .pagination .page-item.disabled .page-link {
          color: #ccc;
          cursor: not-allowed;
        }

        /* Suggestions dropdown styles */
        #suggestions {
          position: absolute; /* Keep it absolute */
          z-index: 1000; /* Ensure it's on top */
          background: white; /* White background */
          border: 1px solid #ddd; /* Border styling */
          border-radius: 4px; /* Rounded corners */
          max-height: 200px; /* Max height */
          overflow-y: auto; /* Scrollable when too long */
          width: calc(100% - 20px); /* Full width minus padding */
          margin-top: 5px; /* Space between input and suggestions */
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Shadow */
          display: none; /* Initially hidden */
          padding: 0; /* Remove padding from the list */
        }

        #suggestions li {
          padding: 10px; /* Padding for each item */
          cursor: pointer; /* Pointer cursor on hover */
          list-style: none; /* Remove default list styles */
        }

        #suggestions li:hover {
          background-color: #f0f0f0; /* Background color on hover */
        }
    body
      header.masthead(style="height: 400px; object-fit: cover; background-position: center; background-repeat: no-repeat;")
        .container.h-100.d-flex.align-items-center.justify-content-center
          span.text-white.px-3.py-2.fs-1.fw-bold.shadow.bg-dark.bg-opacity-50.rounded Món Ăn
        script(type="text/javascript" src="/javascripts/navBar.js")  
      form(method="GET" action="/api/v1/explore")
        .form-group
          section.form-group.pb-0.pt-4
            .col-md-5
            .col-md-2
              label(style="margin-right: 160px;" for="city_id") City:
            .col-md-2(style="margin-right: 20px;")
              select#city_id.form-control(name="city_id" required)
                option(value="" disabled selected) -- Select a City --
                each city in City
                  option(value=city.city_id) #{city.city_name}
            .col-md-2
              button.btn.btn-primary(type="submit") Lọc

      // Danh sách món ăn
      #dishes
        .container
          .col-md-6(style="margin-right: 200px;")
            #map(style="border: 1px solid #ddd; border-radius: 8px; height: 400px;")
            // Thêm thanh tìm kiếm địa chỉ
            .form-group
              input#address-search.form-control(type="text" placeholder="Nhập địa chỉ để tìm kiếm" autocomplete="off")
              button#search-address.btn.btn-primary(type="button") Tìm Kiếm
              ul#suggestions.suggestions(style="list-style-type: none; padding: 0; margin-top: 5px; display: none;")
          .col-md-4
            .row.ml-4
              - if (!dishes || dishes.length === 0)
                .text-center.mt-5
                  p.mt-3.text-muted No dishes found. Check back later!
              - else
                each dish in dishes
                  .col-md-12.mb-4
                    .card.shadow-sm.border-0(style="transition: transform 0.3s ease, box-shadow 0.3s ease;")
                      .card-body.text-center
                        h5.card-title.text-truncate(style="font-size: 1.25rem; font-weight: bold;")= dish.name
                        p.card-text.text-muted.small.mb-2
                          | #{dish.description && dish.description.length > 70 ? dish.description.substring(0, 70) + '...' : dish.description || "No description available."}
                        p.card-text.text-muted.small.mb-2  #{dish.city_name}
                        a.btn.btn-outline-primary.btn-sm.text-uppercase.mt-2(href=`/api/v1/restaurant/${dish.id}` ,style="color: #007bff; transition: background-color 0.3s, color 0.3s;") View Restaurant

      // Pagination
      nav.pagination-nav
        ul.pagination.justify-content-center
          - const visiblePages = 5; // Số trang tối đa hiển thị xung quanh trang hiện tại
          - const startPage = Math.max(1, currentPage - Math.floor(visiblePages / 2));
          - const endPage = Math.min(totalPages, startPage + visiblePages - 1);

          // Previous button
          - if (currentPage > 1)
            li.page-item
              a.page-link(href=`?page=${currentPage - 1}` style="color: #007bff;") Previous

          // Page numbers
          - for (let i = startPage; i <= endPage; i++)
            li.page-item(class=(i === currentPage ? 'active' : ''))
              a.page-link(href=`?page=${i}` style=(i === currentPage ? "background-color: #007bff; border-color: #007bff; color: #fff;" : "color: #007bff;")) #{i}

          // "..." indicator if needed
          - if (endPage < totalPages)
            li.page-item.disabled
              span.page-link ... 
            li.page-item
              a.page-link(href=`?page=${totalPages}` style="color: #007bff;") #{totalPages}

          // Next button
          - if (currentPage < totalPages)
            li.page-item
              a.page-link(href=`?page=${currentPage + 1}` style="color: #007bff;") Next

      script(type="module" src="/javascripts/map.js")